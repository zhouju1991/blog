
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="写程序的猫">
    <title>InnoDB Cluster部署 - 写程序的猫</title>
    <meta name="author" content="CodingCat">
    
        <meta name="keywords" content="CodingCat,写程序的猫,">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"CodingCat","sameAs":["https://github.com/zhouju1991"],"image":"portrait.jpg"},"articleBody":"部署一个MySQL 8.0.25 InnoDB Cluster集群\n\n\nInnoDB Cluster集群简介![InnoDB Cluster架构](InnoDB Cluster架构.jpg)\n环境信息准备三台虚拟机\n\n\n\n\n服务器1\n服务器2\n服务器3\n端口\n\n\n\n操作系统\nCentOS7\nCentOS7\nCentOS7\n/\n\n\nIP\n192.168.165.156\n192.168.165.157\n192.168.165.225\n/\n\n\n主机名\ndb156\ndb156\ndb225\n/\n\n\nMySQL Server 8.0.25\nMGR 节点一\nMGR 节点二\nMGR 节点三\n3306\n\n\nMySQL Shell 8.0.25\nMySQL Shell节点一\nMySQL Shell节点二\nMySQL Shell节点三\n/\n\n\nMySQL Router 8.0.25\nMySQL Router节点一\nMySQL Router节点二\nMySQL Router节点三\n6446(写)、6447（读）\n\n\n部署说明安装顺序安装MySQL Server—&gt;启用组复制—&gt;安装MySQL Shell —&gt; 创建InnoDB Cluster集群—&gt; 安装MySQL Router\n安装包\n\n\n安装包名\nMD5值\n下载连接\n\n\n\nmysql-8.0.25-linux-glibc2.12-x86_64.tar.xz\na12142a969531cebd845844620bb44a4\nhttps://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz\n\n\nmysql-shell-8.0.25-linux-glibc2.12-x86-64bit.tar.gz\n9192ea694ac97a5c5715806ddcf84932\nhttps://dev.mysql.com/get/Downloads/MySQL-Shell/mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz\n\n\nmysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz\nbcd9b81f422667dbabd0a5d7bbf7638a\nhttps://dev.mysql.com/get/Downloads/MySQL-Router/mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz\n\n\n安装MySQL Server安装依赖包创建相关用户1234[root@db156 ~]# groupadd mysql &amp;&amp; useradd -r -g mysql -s &#x2F;bin&#x2F;false mysqlgroupadd: group &#39;mysql&#39; already exists[root@db156 ~]# cat &#x2F;etc&#x2F;passwd | grep -iw  &quot;mysql&quot;mysql:x:997:1000::&#x2F;home&#x2F;mysql:&#x2F;bin&#x2F;false\n\n下载并解压安装包12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455[root@db156 opt]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz--2021-06-10 04:43:21--  https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.25-linux-glibc2.12-x86_64.tar.xzResolving dev.mysql.com (dev.mysql.com)... 137.254.60.11Connecting to dev.mysql.com (dev.mysql.com)|137.254.60.11|:443... connected.HTTP request sent, awaiting response... 302 FoundLocation: https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz [following]--2021-06-10 04:43:22--  https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.25-linux-glibc2.12-x86_64.tar.xzResolving cdn.mysql.com (cdn.mysql.com)... 104.71.212.231Connecting to cdn.mysql.com (cdn.mysql.com)|104.71.212.231|:443... connected.HTTP request sent, awaiting response... 200 OKLength: 896219776 (855M) [text&#x2F;plain]Saving to: ‘mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz’100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 896,219,776 14.2MB&#x2F;s   in 66s    2021-06-10 04:44:29 (13.0 MB&#x2F;s) - ‘mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz’ saved [896219776&#x2F;896219776][root@db156 opt]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-Shell&#x2F;mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz--2021-06-10 04:44:39--  https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-Shell&#x2F;mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gzResolving dev.mysql.com (dev.mysql.com)... 137.254.60.11Connecting to dev.mysql.com (dev.mysql.com)|137.254.60.11|:443... connected.HTTP request sent, awaiting response... 302 FoundLocation: https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-Shell&#x2F;mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz [following]--2021-06-10 04:44:41--  https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-Shell&#x2F;mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gzResolving cdn.mysql.com (cdn.mysql.com)... 104.71.212.231Connecting to cdn.mysql.com (cdn.mysql.com)|104.71.212.231|:443... connected.HTTP request sent, awaiting response... 200 OKLength: 41487987 (40M) [application&#x2F;x-tar-gz]Saving to: ‘mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz’100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 41,487,987  11.6MB&#x2F;s   in 3.8s   2021-06-10 04:44:45 (10.4 MB&#x2F;s) - ‘mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz’ saved [41487987&#x2F;41487987][root@db156 opt]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-Router&#x2F;mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz--2021-06-10 04:44:53--  https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-Router&#x2F;mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xzResolving dev.mysql.com (dev.mysql.com)... 137.254.60.11Connecting to dev.mysql.com (dev.mysql.com)|137.254.60.11|:443... connected.HTTP request sent, awaiting response... 302 FoundLocation: https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-Router&#x2F;mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz [following]--2021-06-10 04:44:54--  https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-Router&#x2F;mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xzResolving cdn.mysql.com (cdn.mysql.com)... 104.71.212.231Connecting to cdn.mysql.com (cdn.mysql.com)|104.71.212.231|:443... connected.HTTP request sent, awaiting response... 200 OKLength: 65288920 (62M) [text&#x2F;plain]Saving to: ‘mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz’100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 65,288,920  12.5MB&#x2F;s   in 6.1s   2021-06-10 04:45:01 (10.3 MB&#x2F;s) - ‘mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz’ saved [65288920&#x2F;65288920][root@db156 opt]# tar -xf mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz[root@db156 opt]# mv mysql-8.0.25-linux-glibc2.12-x86_64 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;[root@db156 opt]# chown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;[root@db156 opt]# chmod -R 755 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;\n\n创建相关目录123[root@db156 opt]# mkdir -p &#x2F;data&#x2F;mysql&#x2F;&#123;data,binlog,relay&#125;[root@db156 opt]# chown -R mysql:mysql &#x2F;data&#x2F;mysql&#x2F;[root@db156 opt]# chmod -R 750 &#x2F;data&#x2F;mysql&#x2F;\n\n\n\n准备配置文件12345678910111213141516171819202122232425262728[mysqld]server_id&#x3D;13306gtid_mode&#x3D;onenforce_gtid_consistency&#x3D;1transaction_write_set_extraction&#x3D;XXHASH64loose-group_replication_group_name&#x3D;&#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&#39;loose-group_replication_start_on_boot&#x3D;offloose-group_replication_ip_whitelist&#x3D;&#39;192.168.165.0&#x2F;24&#39;loose-group_replication_local_address&#x3D;&#39;192.168.165.157:33061&#39;loose-group_replication_group_seeds&#x3D;&#39;192.168.165.156:33061,192.168.165.157:33061,192.168.165.225:33061&#39;loose-group_replication_bootstrap_group&#x3D;offloose-group_replication_single_primary_mode&#x3D;onloose-group_replication_enforce_update_everywhere_checks&#x3D;offloose-group_replication_recovery_get_public_key&#x3D;onloose-group_replication_recovery_use_ssl&#x3D;offloose-group_replication_ssl_mode&#x3D;&#39;DISABLED&#39;loose-group_replication_consistency&#x3D;&#39;EVENTUAL&#39;loose-group_replication_member_expel_timeout&#x3D;5report_host&#x3D;&#39;192.168.165.157&#39;report_port&#x3D;3306plugin_load_add &#x3D;&#39;group_replication.so&#39;auto_increment_increment&#x3D;1auto_increment_offset&#x3D;1mysqlx_port&#x3D;33060admin_port&#x3D;33062datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;databasedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysqluser&#x3D;mysql\n\n初始化MySQL Server123456789101112131415161718[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --initialize-insecure2021-06-10T08:12:00.192163Z 0 [System] [MY-013169] [Server] &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld (mysqld 8.0.25) initializing of server in progress as process 108632021-06-10T08:12:00.364089Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.2021-06-10T08:12:05.120563Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.2021-06-10T08:12:05.548074Z 0 [Warning] [MY-013501] [Server] Ignoring --plugin-load[_add] list as the server is running with --initialize(-insecure).2021-06-10T08:12:06.717610Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_group_name&#x3D;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&#39;.2021-06-10T08:12:06.718217Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_start_on_boot&#x3D;off&#39;.2021-06-10T08:12:06.718823Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_ip_whitelist&#x3D;192.168.165.0&#x2F;24&#39;.2021-06-10T08:12:06.719416Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_local_address&#x3D;192.168.165.156:33061&#39;.2021-06-10T08:12:06.719969Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_group_seeds&#x3D;192.168.165.156:33061,192.168.165.157:33061,192.168.165.225:33061&#39;.2021-06-10T08:12:06.720542Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_bootstrap_group&#x3D;off&#39;.2021-06-10T08:12:06.721103Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_single_primary_mode&#x3D;on&#39;.2021-06-10T08:12:06.721683Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_enforce_update_everywhere_checks&#x3D;off&#39;.2021-06-10T08:12:06.722250Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_recovery_get_public_key&#x3D;on&#39;.2021-06-10T08:12:06.722873Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_recovery_use_ssl&#x3D;off&#39;.2021-06-10T08:12:06.723485Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_ssl_mode&#x3D;DISABLED&#39;.2021-06-10T08:12:06.724060Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_member_expel_timeout&#x3D;5&#39;.2021-06-10T08:12:06.727059Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option.\n\n\n\n配置启动文件并启动MySQL1234567891011121314151617181920212223242526272829303132[root@db156 opt]# vi &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mysqld.service[root@db156 opt]# cat &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mysqld.service[Unit]Description&#x3D;MySQL ServerDocumentation&#x3D;man:mysqld(8)Documentation&#x3D;https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;using-systemd.htmlAfter&#x3D;network.targetAfter&#x3D;syslog.target[Install]WantedBy&#x3D;multi-user.target[Service]User&#x3D;mysqlGroup&#x3D;mysqlExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnfLimitNOFILE &#x3D; 5000[root@db156 opt]# systemctl start mysqld [root@db156 opt]# systemctl status mysqld      ● mysqld.service - MySQL Server   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mysqld.service; disabled; vendor preset: disabled)   Active: active (running) since Thu 2021-06-10 04:57:12 EDT; 10s ago     Docs: man:mysqld(8)           https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;using-systemd.html Main PID: 14232 (mysqld_safe)   CGroup: &#x2F;system.slice&#x2F;mysqld.service           ├─14232 &#x2F;bin&#x2F;sh &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf           └─14626 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql --datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;data --plugin-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin --log-error&#x3D;db156.err --pid-fil...Jun 10 04:57:12 db156 systemd[1]: Started MySQL Server.Jun 10 04:57:13 db156 mysqld_safe[14232]: 2021-06-10T08:57:13.594106Z mysqld_safe Logging to &#39;&#x2F;data&#x2F;mysql&#x2F;data&#x2F;db156.err&#39;.Jun 10 04:57:13 db156 mysqld_safe[14232]: 2021-06-10T08:57:13.689214Z mysqld_safe Starting mysqld daemon with databases from &#x2F;data&#x2F;mysql&#x2F;data\n\n在执行systemctl start mysqld 如果报错Failed to start mysqld.service: Unit not found.,可以执行systemctl daemon-reload解决。\n修改本地账号密码并设置不过期1[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -e &quot;SET SQL_LOG_BIN&#x3D;0;SET global super_read_only&#x3D;OFF; SET global read_only&#x3D;OFF; alter user &#39;root&#39;@&#39;localhost&#39; password expire never; set password for &#39;root&#39;@&#39;localhost&#39;&#x3D;&#39;123456&#39;;flush privileges; SET SQL_LOG_BIN&#x3D;1;&quot;\n\n创建复制账号并授权1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -pEnter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 9Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; SET SQL_LOG_BIN&#x3D;0;Query OK, 0 rows affected (0.00 sec)mysql&gt; CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.156&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.157&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.225&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;Query OK, 0 rows affected (0.04 sec)mysql&gt; CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.157&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;Query OK, 0 rows affected (0.02 sec)mysql&gt; CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.225&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;GRANT REPLICATION SLAVE, REPLICATION CLIENT, BACKUP_ADMIN ON *.* TO &#96;repl&#96;@&#96;192.168.165.156&#96;; Query OK, 0 rows affected (0.01 sec)mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT, BACKUP_ADMIN ON *.* TO &#96;repl&#96;@&#96;192.168.165.156&#96;; Query OK, 0 rows affected (0.01 sec)mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT, BACKUP_ADMIN ON *.* TO &#96;repl&#96;@&#96;192.168.165.157&#96;; Query OK, 0 rows affected (0.01 sec)mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT, BACKUP_ADMIN ON *.* TO &#96;repl&#96;@&#96;192.168.165.225&#96;; Query OK, 0 rows affected (0.00 sec)mysql&gt; FLUSH PRIVILEGES;Query OK, 0 rows affected (0.01 sec)mysql&gt; SET SQL_LOG_BIN&#x3D;1;Query OK, 0 rows affected (0.00 sec)mysql&gt; exitBye[root@db156 opt]# \n\n创建管理账号并授权1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -pEnter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 8Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; SET SQL_LOG_BIN&#x3D;0;Query OK, 0 rows affected (0.00 sec)mysql&gt; CREATE USER IF NOT EXISTS &#96;icadmin&#96;@&#96;192.168.165.%&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;Query OK, 0 rows affected, 1 warning (0.01 sec)mysql&gt; GRANT SELECT, RELOAD, SHUTDOWN, PROCESS, FILE, SUPER, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE USER ON *.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;Query OK, 0 rows affected, 1 warning (0.00 sec)mysql&gt; GRANT BACKUP_ADMIN,CLONE_ADMIN,PERSIST_RO_VARIABLES_ADMIN,REPLICATION_APPLIER,SYSTEM_VARIABLES_ADMIN ON *.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;GRANT INSERT, UPDATE, DELETE ON &#96;mysql&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;Query OK, 0 rows affected (0.01 sec)mysql&gt; GRANT INSERT, UPDATE, DELETE ON &#96;mysql&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;Query OK, 0 rows affected (0.00 sec)mysql&gt; GRANT INSERT, UPDATE, DELETE, CREATE, DROP, REFERENCES, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, EVENT, TRIGGER ON &#96;mysql_innodb_cluster_metadata&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;Query OK, 0 rows affected (0.00 sec)mysql&gt; GRANT INSERT, UPDATE, DELETE, CREATE, DROP, REFERENCES, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, EVENT, TRIGGER ON &#96;mysql_innodb_cluster_metadata_bkp&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;Query OK, 0 rows affected (0.00 sec)mysql&gt; GRANT INSERT, UPDATE, DELETE, CREATE, DROP, REFERENCES, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, EVENT, TRIGGER ON &#96;mysql_innodb_cluster_metadata_previous&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;FLUSH PRIVILEGES;SET SQL_LOG_BIN&#x3D;1;Query OK, 0 rows affected (0.32 sec)mysql&gt; FLUSH PRIVILEGES;Query OK, 0 rows affected (0.00 sec)mysql&gt; SET SQL_LOG_BIN&#x3D;1;Query OK, 0 rows affected (0.00 sec)mysql&gt; exitBye[root@db156 opt]# \n\n\n\n安装组复制插件123456789101112131415161718192021222324252627[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -pEnter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 9Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;ERROR 1125 (HY000): Function &#39;group_replication&#39; already existsmysql&gt; SELECT PLUGIN_NAME, PLUGIN_STATUS FROM INFORMATION_SCHEMA.PLUGINS  WHERE PLUGIN_NAME LIKE &#39;%group_replication%&#39;;+-------------------+---------------+| PLUGIN_NAME       | PLUGIN_STATUS |+-------------------+---------------+| group_replication | ACTIVE        |+-------------------+---------------+1 row in set (0.00 sec)mysql&gt; exitBye[root@db156 opt]# \n\n\n\n设置复制通道12345678910111213141516171819202122232425262728293031[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -pEnter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 10Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; CHANGE MASTER TO MASTER_USER&#x3D;&#39;repl&#39;, MASTER_PASSWORD&#x3D;&#39;123456&#39; FOR CHANNEL &#39;group_replication_recovery&#39;;Query OK, 0 rows affected, 5 warnings (0.01 sec)mysql&gt; SELECT User_name,Channel_name FROM mysql.slave_master_info WHERE user_name &#x3D; &#39;repl&#39;;+-----------+----------------------------+| User_name | Channel_name               |+-----------+----------------------------+| repl      | group_replication_recovery |+-----------+----------------------------+1 row in set (0.00 sec)mysql&gt; SET global group_replication_recovery_get_public_key&#x3D;ON;Query OK, 0 rows affected (0.00 sec)mysql&gt; exitBye[root@db156 opt]# \n\n\n\n查看MySQL进程12345[root@db156 opt]# ps -ef | grep mysqlmysql    14232     1  0 04:57 ?        00:00:00 &#x2F;bin&#x2F;sh &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnfmysql    14626 14232  0 04:57 ?        00:00:03 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql --datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;data --plugin-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin --log-error&#x3D;db156.err --pid-file&#x3D;db156.pidroot     15500  9686  0 05:12 pts&#x2F;0    00:00:00 grep --color&#x3D;auto mysql[root@db156 opt]# \n\n\n\n\n说明：其他两个节点也按照以上步骤部署\n\n启用MGR组复制三个MySQL Server实例部署完成之后，就可以启用组复制了。\n对于组复制，数据必须存储在InnoDB事务存储引擎中，使用其他存储引擎（包括临时 MEMORY存储引擎）可能会导致组复制中的错误。disabled_storage_engines 如下设置 系统变量以防止其使用：\ndisabled_storage_engines=”MyISAM,BLACKHOLE,FEDERATED,ARCHIVE,MEMORY”\n修改配置文件，添加上面的配置并重启即可：\n1234567891011121314151617181920212223242526272829303132[root@db156 opt]# vi &#x2F;etc&#x2F;my.cnf [root@db156 opt]# cat &#x2F;etc&#x2F;my.cnf[mysqld]server_id&#x3D;13306gtid_mode&#x3D;onenforce_gtid_consistency&#x3D;1transaction_write_set_extraction&#x3D;XXHASH64loose-group_replication_group_name&#x3D;&#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&#39;loose-group_replication_start_on_boot&#x3D;offloose-group_replication_ip_whitelist&#x3D;&#39;192.168.165.0&#x2F;24&#39;loose-group_replication_local_address&#x3D;&#39;192.168.165.156:33061&#39;loose-group_replication_group_seeds&#x3D;&#39;192.168.165.156:33061,192.168.165.157:33061,192.168.165.225:33061&#39;loose-group_replication_bootstrap_group&#x3D;offloose-group_replication_single_primary_mode&#x3D;onloose-group_replication_enforce_update_everywhere_checks&#x3D;offloose-group_replication_recovery_get_public_key&#x3D;onloose-group_replication_recovery_use_ssl&#x3D;offloose-group_replication_ssl_mode&#x3D;&#39;DISABLED&#39;loose-group_replication_consistency&#x3D;&#39;EVENTUAL&#39;loose-group_replication_member_expel_timeout&#x3D;5report_host&#x3D;&#39;192.168.165.156&#39;report_port&#x3D;3306plugin_load_add &#x3D;&#39;group_replication.so&#39;auto_increment_increment&#x3D;1auto_increment_offset&#x3D;1mysqlx_port&#x3D;33060admin_port&#x3D;33062datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;databasedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysqluser&#x3D;mysqlbled_storage_engines&#x3D;&quot;MyISAM,BLACKHOLE,FEDERATED,ARCHIVE,MEMORY&quot;[root@db225 opt]# systemctl restart mysqld\n\n\n\n首次启动组复制的过程称为引导，，可以使用group_replication_bootstrap_group系统变量来引导组，且只能在一个实例上执行并只能执行一次。\n我们选择节点一上执行：\n123456789101112131415161718192021222324[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -pEnter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 8Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; SET GLOBAL group_replication_bootstrap_group&#x3D;ON;Query OK, 0 rows affected (0.01 sec)mysql&gt; START GROUP_REPLICATION USER&#x3D;&#39;repl&#39;, PASSWORD&#x3D;&#39;123456&#39;;Query OK, 0 rows affected, 1 warning (2.22 sec)mysql&gt; SET GLOBAL group_replication_bootstrap_group&#x3D;OFF;Query OK, 0 rows affected (0.00 sec)mysql&gt; \n\n节点二及节点三：\n123456789101112131415161718[root@db225 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -pEnter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 8Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; START GROUP_REPLICATION USER&#x3D;&#39;repl&#39;, PASSWORD&#x3D;&#39;123456&#39;;Query OK, 0 rows affected, 1 warning (2.64 sec)mysql&gt; \n\n在将其他节点添加至复制组时，如果报一下错误：\n12mysql&gt; START GROUP_REPLICATION USER&#x3D;&#39;repl&#39;, PASSWORD&#x3D;&#39;123456&#39;;ERROR 3092 (HY000): The server is not configured properly to be an active member of the group. Please see more details on error log.\n\n查看到日志如下：\n1234562021-06-10T10:42:54.535154Z 10 [System] [MY-010597] [Repl] &#39;CHANGE MASTER TO FOR CHANNEL &#39;group_replication_applier&#39; executed&#39;. Previous state master_host&#x3D;&#39;&#39;, master_port&#x3D; 3306, master_log_file&#x3D;&#39;&#39;, master_log_pos&#x3D; 4, master_bind&#x3D;&#39;&#39;. New state master_host&#x3D;&#39;&lt;NULL&gt;&#39;, master_port&#x3D; 0, master_log_file&#x3D;&#39;&#39;, master_log_pos&#x3D; 4, master_bind&#x3D;&#39;&#39;.2021-06-10T10:42:57.045266Z 0 [ERROR] [MY-011526] [Repl] Plugin group_replication reported: &#39;This member has more executed transactions than those present in the group. Local transactions: 689d5d1d-c9cc-11eb-8243-005056a0d28b:1 &gt; Group transactions: aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&#39;2021-06-10T10:42:57.056782Z 0 [ERROR] [MY-011522] [Repl] Plugin group_replication reported: &#39;The member contains transactions not present in the group. The member will now exit the group.&#39;2021-06-10T10:42:57.056911Z 0 [System] [MY-011503] [Repl] Plugin group_replication reported: &#39;Group membership changed to 192.168.165.157:3306, 192.168.165.156:3306 on view 16233217077427225:2.&#39;2021-06-10T10:43:00.730039Z 0 [System] [MY-011504] [Repl] Plugin group_replication reported: &#39;Group membership changed: This member has left the group.&#39;2021-06-10T10:43:00.758719Z 9 [System] [MY-011566] [Repl] Plugin group_replication reported: &#39;Setting super_read_only&#x3D;OFF.&#39;\n\n则在该节点上执行reset master可以解决。\n查看组复制状态(任何一个实例均可查询)：\n1234567891011mysql&gt; select * FROM performance_schema.replication_group_members;+---------------------------+--------------------------------------+-----------------+-------------+--------------+-------------+----------------+| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST     | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION |+---------------------------+--------------------------------------+-----------------+-------------+--------------+-------------+----------------+| group_replication_applier | 689d5d1d-c9cc-11eb-8243-005056a0d28b | 192.168.165.157 |        3306 | ONLINE       | SECONDARY   | 8.0.25         || group_replication_applier | 71d57215-c9cc-11eb-a5ac-005056a098ec | 192.168.165.225 |        3306 | ONLINE       | SECONDARY   | 8.0.25         || group_replication_applier | 8b5f525d-c9c3-11eb-bf4e-005056a0bb1a | 192.168.165.156 |        3306 | ONLINE       | PRIMARY     | 8.0.25         |+---------------------------+--------------------------------------+-----------------+-------------+--------------+-------------+----------------+3 rows in set (1.54 sec)mysql&gt; \n\n至此，MGR三节点的组复制搭建完成。\n安装MySQL Shell安装过程如下：\n123456[root@db156 opt]# tar -xf mysql-shell-8.0.25-linux-glibc2.12-x86-64bit.tar.gz [root@db156 opt]# mv mysql-shell-8.0.25-linux-glibc2.12-x86-64bit &#x2F;usr&#x2F;local&#x2F;mysqlshell[root@db156 opt]# chown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysqlshell&#x2F;[root@db156 opt]# chmod -R 755 &#x2F;usr&#x2F;local&#x2F;mysqlshell&#x2F;[root@db156 opt]# echo &quot;export PATH&#x3D;\\$PATH:&#x2F;usr&#x2F;local&#x2F;mysqlshell&#x2F;bin&quot; &gt;&gt; &#x2F;etc&#x2F;profile[root@db156 opt]# source &#x2F;etc&#x2F;profile\n\n三个节点均执行以上步骤安装。\n创建InnoDB Cluster集群通过mysqlsh命令使用安装MySQL Server时创建的管理账号连接到MySQL 实例，执行dba.createCluster()创建集群，并过过dba.getCluster(&quot;testCluster&quot;).status()查看集群状态：\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384[root@db225 opt]# mysqlsh icadmin@192.168.165.156:3306Please provide the password for &#39;icadmin@192.168.165.156:3306&#39;: ******Save password for &#39;icadmin@192.168.165.156:3306&#39;? [Y]es&#x2F;[N]o&#x2F;Ne[v]er (default No): MySQL Shell 8.0.25Copyright (c) 2016, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or its affiliates.Other names may be trademarks of their respective owners.Type &#39;\\help&#39; or &#39;\\?&#39; for help; &#39;\\quit&#39; to exit.Creating a session to &#39;icadmin@192.168.165.156:3306&#39;Fetching schema names for autocompletion... Press ^C to stop.Your MySQL connection id is 28Server version: 8.0.25 MySQL Community Server - GPLNo default schema selected; type \\use &lt;schema&gt; to set one. MySQL  192.168.165.156:3306 ssl  JS &gt; var cluster &#x3D; dba.createCluster(&#39;testCluster&#39;, &#123;adoptFromGR: true&#125;);A new InnoDB cluster will be created based on the existing replication group on instance &#39;192.168.165.156:3306&#39;.Creating InnoDB cluster &#39;testCluster&#39; on &#39;192.168.165.156:3306&#39;...Adding Seed Instance...Adding Instance &#39;192.168.165.157:3306&#39;...Adding Instance &#39;192.168.165.225:3306&#39;...Adding Instance &#39;192.168.165.156:3306&#39;...Resetting distributed recovery credentials across the cluster...NOTE: User &#39;mysql_innodb_cluster_13306&#39;@&#39;%&#39; already existed at instance &#39;192.168.165.156:3306&#39;. It will be deleted and created again with a new password.NOTE: User &#39;mysql_innodb_cluster_13306&#39;@&#39;%&#39; already existed at instance &#39;192.168.165.156:3306&#39;. It will be deleted and created again with a new password.Cluster successfully created based on existing replication group. MySQL  192.168.165.156:3306 ssl  JS &gt; dba.getCluster(&quot;testCluster&quot;).status();&#123;    &quot;clusterName&quot;: &quot;testCluster&quot;,     &quot;defaultReplicaSet&quot;: &#123;        &quot;name&quot;: &quot;default&quot;,         &quot;primary&quot;: &quot;192.168.165.156:3306&quot;,         &quot;ssl&quot;: &quot;DISABLED&quot;,         &quot;status&quot;: &quot;OK&quot;,         &quot;statusText&quot;: &quot;Cluster is ONLINE and can tolerate up to ONE failure.&quot;,         &quot;topology&quot;: &#123;            &quot;192.168.165.156:3306&quot;: &#123;                &quot;address&quot;: &quot;192.168.165.156:3306&quot;,                 &quot;instanceErrors&quot;: [                    &quot;NOTE: The required parallel-appliers settings are not enabled on the instance. Use dba.configureInstance() to fix it.&quot;                ],                 &quot;memberRole&quot;: &quot;PRIMARY&quot;,                 &quot;mode&quot;: &quot;R&#x2F;W&quot;,                 &quot;readReplicas&quot;: &#123;&#125;,                 &quot;replicationLag&quot;: null,                 &quot;role&quot;: &quot;HA&quot;,                 &quot;status&quot;: &quot;ONLINE&quot;,                 &quot;version&quot;: &quot;8.0.25&quot;            &#125;,             &quot;192.168.165.157:3306&quot;: &#123;                &quot;address&quot;: &quot;192.168.165.157:3306&quot;,                 &quot;instanceErrors&quot;: [                    &quot;NOTE: The required parallel-appliers settings are not enabled on the instance. Use dba.configureInstance() to fix it.&quot;                ],                 &quot;memberRole&quot;: &quot;SECONDARY&quot;,                 &quot;mode&quot;: &quot;R&#x2F;O&quot;,                 &quot;readReplicas&quot;: &#123;&#125;,                 &quot;replicationLag&quot;: null,                 &quot;role&quot;: &quot;HA&quot;,                 &quot;status&quot;: &quot;ONLINE&quot;,                 &quot;version&quot;: &quot;8.0.25&quot;            &#125;,             &quot;192.168.165.225:3306&quot;: &#123;                &quot;address&quot;: &quot;192.168.165.225:3306&quot;,                 &quot;instanceErrors&quot;: [                    &quot;NOTE: The required parallel-appliers settings are not enabled on the instance. Use dba.configureInstance() to fix it.&quot;                ],                 &quot;memberRole&quot;: &quot;SECONDARY&quot;,                 &quot;mode&quot;: &quot;R&#x2F;O&quot;,                 &quot;readReplicas&quot;: &#123;&#125;,                 &quot;replicationLag&quot;: null,                 &quot;role&quot;: &quot;HA&quot;,                 &quot;status&quot;: &quot;ONLINE&quot;,                 &quot;version&quot;: &quot;8.0.25&quot;            &#125;        &#125;,         &quot;topologyMode&quot;: &quot;Single-Primary&quot;    &#125;,     &quot;groupInformationSourceMember&quot;: &quot;192.168.165.156:3306&quot;&#125; MySQL  192.168.165.156:3306 ssl  JS &gt; \n\n其中：\n\n“status”: “OK” 表示集群状态是正常的\n“topologyMode”: “Single-Primary” 表示是单主模式\n“mode”: “R/W” 表示可读可写\n“mode”: “R/O” 表示只读\n\n安装MySQL Router安装：\n12345678[root@db156 opt]# tar -xf mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz [root@db156 opt]# mv mysql-router-8.0.25-linux-glibc2.12-x86_64 &#x2F;usr&#x2F;local&#x2F;mysqlrouter[root@db156 opt]# chown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;[root@db156 opt]# chmod -R 755 &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;[root@db156 opt]# mkdir -p &#x2F;data&#x2F;mysqlrouter[root@db156 opt]# chown -R mysql:mysql &#x2F;data&#x2F;mysqlrouter&#x2F;[root@db156 opt]# echo &quot;export PATH&#x3D;\\$PATH:&#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&quot; &gt;&gt; &#x2F;etc&#x2F;profile[root@db156 opt]# source &#x2F;etc&#x2F;profile\n\nbootstrap引导:\n1234567891011121314151617181920212223242526272829[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&#x2F;mysqlrouter --bootstrap icadmin@192.168.165.156:3306 --directory &#x2F;data&#x2F;mysqlrouter --conf-use-sockets --user&#x3D;mysql --name&#x3D;mysql_router_13306 --conf-bind-address&#x3D;192.168.165.156 --account-host&#x3D;&quot;192.168.165.%&quot;Please enter MySQL password for icadmin: # Bootstrapping MySQL Router instance at &#39;&#x2F;data&#x2F;mysqlrouter&#39;...- Creating account(s) (only those that are needed, if any)- Verifying account (using it to run SQL queries that would be run by Router)- Storing account in keyring- Adjusting permissions of generated files- Creating configuration &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf# MySQL Router &#39;mysql_router_13306&#39; configured for the InnoDB Cluster &#39;testCluster&#39;After this MySQL Router has been started with the generated configuration    $ &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&#x2F;mysqlrouter -c &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.confthe cluster &#39;testCluster&#39; can be reached by connecting to:## MySQL Classic protocol- Read&#x2F;Write Connections: localhost:6446, &#x2F;data&#x2F;mysqlrouter&#x2F;mysql.sock- Read&#x2F;Only Connections:  localhost:6447, &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlro.sock## MySQL X protocol- Read&#x2F;Write Connections: localhost:6448, &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlx.sock- Read&#x2F;Only Connections:  localhost:6449, &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlxro.sock[root@db156 opt]# \n\n引导成功后会在/data/mysqlrouter目录下生成所需的数据文件，目录结构如下：\n123456789101112131415161718[root@db156 opt]# tree &#x2F;data&#x2F;mysqlrouter&#x2F;&#x2F;data&#x2F;mysqlrouter&#x2F;├── data│   ├── ca-key.pem│   ├── ca.pem│   ├── keyring│   ├── router-cert.pem│   ├── router-key.pem│   └── state.json├── log│   └── mysqlrouter.log├── mysqlrouter.conf├── mysqlrouter.key├── run├── start.sh└── stop.sh3 directories, 11 files\n\n生成的MySQL Router配置文件如下：\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990[root@db156 opt]# cat &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf # File automatically generated during MySQL Router bootstrap[DEFAULT]name&#x3D;mysql_router_13306user&#x3D;mysqllogging_folder&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;logruntime_folder&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;rundata_folder&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;datakeyring_path&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;keyringmaster_key_path&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.keyconnect_timeout&#x3D;15read_timeout&#x3D;30dynamic_state&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;state.jsonclient_ssl_cert&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;router-cert.pemclient_ssl_key&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;router-key.pemclient_ssl_mode&#x3D;PREFERREDserver_ssl_mode&#x3D;AS_CLIENTserver_ssl_verify&#x3D;DISABLED[logger]level &#x3D; INFO[metadata_cache:testCluster]cluster_type&#x3D;grrouter_id&#x3D;1user&#x3D;mysql_router1_7d9sq1vuggg9metadata_cluster&#x3D;testClusterttl&#x3D;0.5auth_cache_ttl&#x3D;-1auth_cache_refresh_interval&#x3D;2use_gr_notifications&#x3D;0[routing:testCluster_rw]bind_address&#x3D;192.168.165.156bind_port&#x3D;6446socket&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysql.sockdestinations&#x3D;metadata-cache:&#x2F;&#x2F;testCluster&#x2F;?role&#x3D;PRIMARYrouting_strategy&#x3D;first-availableprotocol&#x3D;classic[routing:testCluster_ro]bind_address&#x3D;192.168.165.156bind_port&#x3D;6447socket&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlro.sockdestinations&#x3D;metadata-cache:&#x2F;&#x2F;testCluster&#x2F;?role&#x3D;SECONDARYrouting_strategy&#x3D;round-robin-with-fallbackprotocol&#x3D;classic[routing:testCluster_x_rw]bind_address&#x3D;192.168.165.156bind_port&#x3D;6448socket&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlx.sockdestinations&#x3D;metadata-cache:&#x2F;&#x2F;testCluster&#x2F;?role&#x3D;PRIMARYrouting_strategy&#x3D;first-availableprotocol&#x3D;x[routing:testCluster_x_ro]bind_address&#x3D;192.168.165.156bind_port&#x3D;6449socket&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlxro.sockdestinations&#x3D;metadata-cache:&#x2F;&#x2F;testCluster&#x2F;?role&#x3D;SECONDARYrouting_strategy&#x3D;round-robin-with-fallbackprotocol&#x3D;x[http_server]port&#x3D;8443ssl&#x3D;1ssl_cert&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;router-cert.pemssl_key&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;router-key.pem[http_auth_realm:default_auth_realm]backend&#x3D;default_auth_backendmethod&#x3D;basicname&#x3D;default_realm[rest_router]require_realm&#x3D;default_auth_realm[rest_api][http_auth_backend:default_auth_backend]backend&#x3D;metadata_cache[rest_routing]require_realm&#x3D;default_auth_realm[rest_metadata_cache]require_realm&#x3D;default_auth_realm[root@db156 opt]# \n\n启动MySQL路由：\n12345[root@db156 opt]# bash &#x2F;data&#x2F;mysqlrouter&#x2F;start.sh 2&gt;&amp;1 &gt; &#x2F;dev&#x2F;null &amp;[root@db156 opt]# ps -ef | grep mysqlrouterroot     24911     1  0 08:00 pts&#x2F;0    00:00:00 sudo ROUTER_PID&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.pid &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&#x2F;mysqlrouter -c &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf --user&#x3D;mysqlmysql    24913 24911  2 08:00 pts&#x2F;0    00:00:01 &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&#x2F;mysqlrouter -c &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf --user&#x3D;mysqlroot     24998  9686  0 08:01 pts&#x2F;0    00:00:00 grep --color&#x3D;auto mysqlrouter\n\n读写分离测试：使用不同的端口\n1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uicadmin -p -h 192.168.165.156 -P 6446    Enter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 196Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; select @@hostname as hostname, @@port as port;+----------+------+| hostname | port |+----------+------+| db156    | 3306 |+----------+------+1 row in set (0.00 sec)mysql&gt; exitBye[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uicadmin -p -h 192.168.165.156 -P 6447Enter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 30Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; select @@hostname as hostname, @@port as port;+----------+------+| hostname | port |+----------+------+| db225    | 3306 |+----------+------+1 row in set (0.00 sec)mysql&gt; exitBye[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uicadmin -p -h 192.168.165.156 -P 6447Enter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 1517Server version: 8.0.25 MySQL Community Server - GPLCopyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.Oracle is a registered trademark of Oracle Corporation and&#x2F;or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.mysql&gt; select @@hostname as hostname, @@port as port;+----------+------+| hostname | port |+----------+------+| db157    | 3306 |+----------+------+1 row in set (0.00 sec)mysql&gt; \n\n可以看到使用读写端口6446时连接的是主节点，而使用只读端口6447连接时是在两个从节点之间切换操作。\n","dateCreated":"2021-06-10T16:22:15+00:00","dateModified":"2021-07-14T13:01:00+00:00","datePublished":"2021-06-10T16:22:15+00:00","description":"部署一个MySQL 8.0.25 InnoDB Cluster集群","headline":"InnoDB Cluster部署","image":["bg.jpg","bg.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"},"publisher":{"@type":"Organization","name":"CodingCat","sameAs":["https://github.com/zhouju1991"],"image":"portrait.jpg","logo":{"@type":"ImageObject","url":"portrait.jpg"}},"url":"http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/","keywords":"MySQL, InnoDB Cluster","thumbnailUrl":"bg.jpg"}</script>
    <meta name="description" content="部署一个MySQL 8.0.25 InnoDB Cluster集群">
<meta property="og:type" content="blog">
<meta property="og:title" content="InnoDB Cluster部署">
<meta property="og:url" content="http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/index.html">
<meta property="og:site_name" content="写程序的猫">
<meta property="og:description" content="部署一个MySQL 8.0.25 InnoDB Cluster集群">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-06-10T16:22:15.000Z">
<meta property="article:modified_time" content="2021-07-14T13:01:00.016Z">
<meta property="article:author" content="CodingCat">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="InnoDB Cluster">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="http://blog.codingcat.net/assets/images/portrait.jpg"/>
    
    
        <meta property="og:image" content="http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/bg.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/bg.jpg"/>
    
    
        <meta property="og:image" content="http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/bg.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/bg.jpg"/>
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-khxwazv8lvtak2nw1cxe7duwn1izoylfjirmh8gjw0q5atflrduqpxozf97i.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            写程序的猫
        </a>
    </div>
    
        
            <a
                class="header-right-icon st-search-show-outputs"
                href="#search"
                aria-label="打开链接: /#search"
            >
        
        
            <i class="search fa-lg"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="阅读有关作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/portrait.jpg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">CodingCat</h4>
                
                    <h5 class="sidebar-profile-bio"><p>一个有诗意的程序员</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首页"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分类"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="标签"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="归档"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜索"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="关于"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/zhouju1991"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-left
                    post-header-cover--partial"
             style="background-image:url('/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/bg.jpg');"
             data-behavior="4">
            
        </div>

            <div id="main" data-behavior="4"
                 class="hasCover
                        hasCoverMetaOut
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            InnoDB Cluster部署
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-06-10T16:22:15+00:00">
	
		    6月 10, 2021
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/MySQL/">MySQL</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>部署一个MySQL 8.0.25 InnoDB Cluster集群</p>
<span id="more"></span>

<h2 id="InnoDB-Cluster集群简介"><a href="#InnoDB-Cluster集群简介" class="headerlink" title="InnoDB Cluster集群简介"></a>InnoDB Cluster集群简介</h2><p>![InnoDB Cluster架构](InnoDB Cluster架构.jpg)</p>
<h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><p>准备三台虚拟机</p>
<table>
<thead>
<tr>
<th></th>
<th>服务器1</th>
<th>服务器2</th>
<th>服务器3</th>
<th>端口</th>
</tr>
</thead>
<tbody><tr>
<td>操作系统</td>
<td>CentOS7</td>
<td>CentOS7</td>
<td>CentOS7</td>
<td>/</td>
</tr>
<tr>
<td>IP</td>
<td>192.168.165.156</td>
<td>192.168.165.157</td>
<td>192.168.165.225</td>
<td>/</td>
</tr>
<tr>
<td>主机名</td>
<td>db156</td>
<td>db156</td>
<td>db225</td>
<td>/</td>
</tr>
<tr>
<td>MySQL Server 8.0.25</td>
<td>MGR 节点一</td>
<td>MGR 节点二</td>
<td>MGR 节点三</td>
<td>3306</td>
</tr>
<tr>
<td>MySQL Shell 8.0.25</td>
<td>MySQL Shell节点一</td>
<td>MySQL Shell节点二</td>
<td>MySQL Shell节点三</td>
<td>/</td>
</tr>
<tr>
<td>MySQL Router 8.0.25</td>
<td>MySQL Router节点一</td>
<td>MySQL Router节点二</td>
<td>MySQL Router节点三</td>
<td>6446(写)、6447（读）</td>
</tr>
</tbody></table>
<h2 id="部署说明"><a href="#部署说明" class="headerlink" title="部署说明"></a>部署说明</h2><h3 id="安装顺序"><a href="#安装顺序" class="headerlink" title="安装顺序"></a>安装顺序</h3><p>安装MySQL Server—&gt;启用组复制—&gt;安装MySQL Shell —&gt; 创建InnoDB Cluster集群—&gt; 安装MySQL Router</p>
<h3 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h3><table>
<thead>
<tr>
<th>安装包名</th>
<th>MD5值</th>
<th>下载连接</th>
</tr>
</thead>
<tbody><tr>
<td>mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</td>
<td>a12142a969531cebd845844620bb44a4</td>
<td><a target="_blank" rel="noopener" href="https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz">https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</a></td>
</tr>
<tr>
<td>mysql-shell-8.0.25-linux-glibc2.12-x86-64bit.tar.gz</td>
<td>9192ea694ac97a5c5715806ddcf84932</td>
<td><a target="_blank" rel="noopener" href="https://dev.mysql.com/get/Downloads/MySQL-Shell/mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz">https://dev.mysql.com/get/Downloads/MySQL-Shell/mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz</a></td>
</tr>
<tr>
<td>mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz</td>
<td>bcd9b81f422667dbabd0a5d7bbf7638a</td>
<td><a target="_blank" rel="noopener" href="https://dev.mysql.com/get/Downloads/MySQL-Router/mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz">https://dev.mysql.com/get/Downloads/MySQL-Router/mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz</a></td>
</tr>
</tbody></table>
<h2 id="安装MySQL-Server"><a href="#安装MySQL-Server" class="headerlink" title="安装MySQL Server"></a>安装MySQL Server</h2><h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><h3 id="创建相关用户"><a href="#创建相关用户" class="headerlink" title="创建相关用户"></a>创建相关用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 ~]# groupadd mysql &amp;&amp; useradd -r -g mysql -s &#x2F;bin&#x2F;false mysql</span><br><span class="line">groupadd: group &#39;mysql&#39; already exists</span><br><span class="line">[root@db156 ~]# cat &#x2F;etc&#x2F;passwd | grep -iw  &quot;mysql&quot;</span><br><span class="line">mysql:x:997:1000::&#x2F;home&#x2F;mysql:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>

<h3 id="下载并解压安装包"><a href="#下载并解压安装包" class="headerlink" title="下载并解压安装包"></a>下载并解压安装包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">--2021-06-10 04:43:21--  https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">Resolving dev.mysql.com (dev.mysql.com)... 137.254.60.11</span><br><span class="line">Connecting to dev.mysql.com (dev.mysql.com)|137.254.60.11|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 302 Found</span><br><span class="line">Location: https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz [following]</span><br><span class="line">--2021-06-10 04:43:22--  https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">Resolving cdn.mysql.com (cdn.mysql.com)... 104.71.212.231</span><br><span class="line">Connecting to cdn.mysql.com (cdn.mysql.com)|104.71.212.231|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 896219776 (855M) [text&#x2F;plain]</span><br><span class="line">Saving to: ‘mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz’</span><br><span class="line"></span><br><span class="line">100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 896,219,776 14.2MB&#x2F;s   in 66s    </span><br><span class="line"></span><br><span class="line">2021-06-10 04:44:29 (13.0 MB&#x2F;s) - ‘mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz’ saved [896219776&#x2F;896219776]</span><br><span class="line"></span><br><span class="line">[root@db156 opt]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-Shell&#x2F;mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz</span><br><span class="line">--2021-06-10 04:44:39--  https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-Shell&#x2F;mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz</span><br><span class="line">Resolving dev.mysql.com (dev.mysql.com)... 137.254.60.11</span><br><span class="line">Connecting to dev.mysql.com (dev.mysql.com)|137.254.60.11|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 302 Found</span><br><span class="line">Location: https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-Shell&#x2F;mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz [following]</span><br><span class="line">--2021-06-10 04:44:41--  https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-Shell&#x2F;mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz</span><br><span class="line">Resolving cdn.mysql.com (cdn.mysql.com)... 104.71.212.231</span><br><span class="line">Connecting to cdn.mysql.com (cdn.mysql.com)|104.71.212.231|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 41487987 (40M) [application&#x2F;x-tar-gz]</span><br><span class="line">Saving to: ‘mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz’</span><br><span class="line"></span><br><span class="line">100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 41,487,987  11.6MB&#x2F;s   in 3.8s   </span><br><span class="line"></span><br><span class="line">2021-06-10 04:44:45 (10.4 MB&#x2F;s) - ‘mysql-shell-8.0.25-linux-glibc2.12-x86-32bit.tar.gz’ saved [41487987&#x2F;41487987]</span><br><span class="line"></span><br><span class="line">[root@db156 opt]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-Router&#x2F;mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">--2021-06-10 04:44:53--  https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-Router&#x2F;mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">Resolving dev.mysql.com (dev.mysql.com)... 137.254.60.11</span><br><span class="line">Connecting to dev.mysql.com (dev.mysql.com)|137.254.60.11|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 302 Found</span><br><span class="line">Location: https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-Router&#x2F;mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz [following]</span><br><span class="line">--2021-06-10 04:44:54--  https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-Router&#x2F;mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">Resolving cdn.mysql.com (cdn.mysql.com)... 104.71.212.231</span><br><span class="line">Connecting to cdn.mysql.com (cdn.mysql.com)|104.71.212.231|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 65288920 (62M) [text&#x2F;plain]</span><br><span class="line">Saving to: ‘mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz’</span><br><span class="line"></span><br><span class="line">100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 65,288,920  12.5MB&#x2F;s   in 6.1s   </span><br><span class="line"></span><br><span class="line">2021-06-10 04:45:01 (10.3 MB&#x2F;s) - ‘mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz’ saved [65288920&#x2F;65288920]</span><br><span class="line"></span><br><span class="line">[root@db156 opt]# tar -xf mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">[root@db156 opt]# mv mysql-8.0.25-linux-glibc2.12-x86_64 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;</span><br><span class="line">[root@db156 opt]# chown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;</span><br><span class="line">[root@db156 opt]# chmod -R 755 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;</span><br></pre></td></tr></table></figure>

<h3 id="创建相关目录"><a href="#创建相关目录" class="headerlink" title="创建相关目录"></a>创建相关目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# mkdir -p &#x2F;data&#x2F;mysql&#x2F;&#123;data,binlog,relay&#125;</span><br><span class="line">[root@db156 opt]# chown -R mysql:mysql &#x2F;data&#x2F;mysql&#x2F;</span><br><span class="line">[root@db156 opt]# chmod -R 750 &#x2F;data&#x2F;mysql&#x2F;</span><br></pre></td></tr></table></figure>



<h3 id="准备配置文件"><a href="#准备配置文件" class="headerlink" title="准备配置文件"></a>准备配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server_id&#x3D;13306</span><br><span class="line">gtid_mode&#x3D;on</span><br><span class="line">enforce_gtid_consistency&#x3D;1</span><br><span class="line">transaction_write_set_extraction&#x3D;XXHASH64</span><br><span class="line">loose-group_replication_group_name&#x3D;&#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&#39;</span><br><span class="line">loose-group_replication_start_on_boot&#x3D;off</span><br><span class="line">loose-group_replication_ip_whitelist&#x3D;&#39;192.168.165.0&#x2F;24&#39;</span><br><span class="line">loose-group_replication_local_address&#x3D;&#39;192.168.165.157:33061&#39;</span><br><span class="line">loose-group_replication_group_seeds&#x3D;&#39;192.168.165.156:33061,192.168.165.157:33061,192.168.165.225:33061&#39;</span><br><span class="line">loose-group_replication_bootstrap_group&#x3D;off</span><br><span class="line">loose-group_replication_single_primary_mode&#x3D;on</span><br><span class="line">loose-group_replication_enforce_update_everywhere_checks&#x3D;off</span><br><span class="line">loose-group_replication_recovery_get_public_key&#x3D;on</span><br><span class="line">loose-group_replication_recovery_use_ssl&#x3D;off</span><br><span class="line">loose-group_replication_ssl_mode&#x3D;&#39;DISABLED&#39;</span><br><span class="line">loose-group_replication_consistency&#x3D;&#39;EVENTUAL&#39;</span><br><span class="line">loose-group_replication_member_expel_timeout&#x3D;5</span><br><span class="line">report_host&#x3D;&#39;192.168.165.157&#39;</span><br><span class="line">report_port&#x3D;3306</span><br><span class="line">plugin_load_add &#x3D;&#39;group_replication.so&#39;</span><br><span class="line">auto_increment_increment&#x3D;1</span><br><span class="line">auto_increment_offset&#x3D;1</span><br><span class="line">mysqlx_port&#x3D;33060</span><br><span class="line">admin_port&#x3D;33062</span><br><span class="line">datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;data</span><br><span class="line">basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">user&#x3D;mysql</span><br></pre></td></tr></table></figure>

<h3 id="初始化MySQL-Server"><a href="#初始化MySQL-Server" class="headerlink" title="初始化MySQL Server"></a>初始化MySQL Server</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --initialize-insecure</span><br><span class="line">2021-06-10T08:12:00.192163Z 0 [System] [MY-013169] [Server] &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld (mysqld 8.0.25) initializing of server in progress as process 10863</span><br><span class="line">2021-06-10T08:12:00.364089Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2021-06-10T08:12:05.120563Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">2021-06-10T08:12:05.548074Z 0 [Warning] [MY-013501] [Server] Ignoring --plugin-load[_add] list as the server is running with --initialize(-insecure).</span><br><span class="line">2021-06-10T08:12:06.717610Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_group_name&#x3D;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&#39;.</span><br><span class="line">2021-06-10T08:12:06.718217Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_start_on_boot&#x3D;off&#39;.</span><br><span class="line">2021-06-10T08:12:06.718823Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_ip_whitelist&#x3D;192.168.165.0&#x2F;24&#39;.</span><br><span class="line">2021-06-10T08:12:06.719416Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_local_address&#x3D;192.168.165.156:33061&#39;.</span><br><span class="line">2021-06-10T08:12:06.719969Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_group_seeds&#x3D;192.168.165.156:33061,192.168.165.157:33061,192.168.165.225:33061&#39;.</span><br><span class="line">2021-06-10T08:12:06.720542Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_bootstrap_group&#x3D;off&#39;.</span><br><span class="line">2021-06-10T08:12:06.721103Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_single_primary_mode&#x3D;on&#39;.</span><br><span class="line">2021-06-10T08:12:06.721683Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_enforce_update_everywhere_checks&#x3D;off&#39;.</span><br><span class="line">2021-06-10T08:12:06.722250Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_recovery_get_public_key&#x3D;on&#39;.</span><br><span class="line">2021-06-10T08:12:06.722873Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_recovery_use_ssl&#x3D;off&#39;.</span><br><span class="line">2021-06-10T08:12:06.723485Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_ssl_mode&#x3D;DISABLED&#39;.</span><br><span class="line">2021-06-10T08:12:06.724060Z 0 [Warning] [MY-000067] [Server] unknown variable &#39;loose-group_replication_member_expel_timeout&#x3D;5&#39;.</span><br><span class="line">2021-06-10T08:12:06.727059Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option.</span><br></pre></td></tr></table></figure>



<h3 id="配置启动文件并启动MySQL"><a href="#配置启动文件并启动MySQL" class="headerlink" title="配置启动文件并启动MySQL"></a>配置启动文件并启动MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# vi &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mysqld.service</span><br><span class="line">[root@db156 opt]# cat &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mysqld.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;MySQL Server</span><br><span class="line">Documentation&#x3D;man:mysqld(8)</span><br><span class="line">Documentation&#x3D;https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;using-systemd.html</span><br><span class="line">After&#x3D;network.target</span><br><span class="line">After&#x3D;syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;mysql</span><br><span class="line">Group&#x3D;mysql</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf</span><br><span class="line">LimitNOFILE &#x3D; 5000</span><br><span class="line">[root@db156 opt]# systemctl start mysqld </span><br><span class="line">[root@db156 opt]# systemctl status mysqld      </span><br><span class="line">● mysqld.service - MySQL Server</span><br><span class="line">   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mysqld.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Thu 2021-06-10 04:57:12 EDT; 10s ago</span><br><span class="line">     Docs: man:mysqld(8)</span><br><span class="line">           https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;using-systemd.html</span><br><span class="line"> Main PID: 14232 (mysqld_safe)</span><br><span class="line">   CGroup: &#x2F;system.slice&#x2F;mysqld.service</span><br><span class="line">           ├─14232 &#x2F;bin&#x2F;sh &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf</span><br><span class="line">           └─14626 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql --datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;data --plugin-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin --log-error&#x3D;db156.err --pid-fil...</span><br><span class="line"></span><br><span class="line">Jun 10 04:57:12 db156 systemd[1]: Started MySQL Server.</span><br><span class="line">Jun 10 04:57:13 db156 mysqld_safe[14232]: 2021-06-10T08:57:13.594106Z mysqld_safe Logging to &#39;&#x2F;data&#x2F;mysql&#x2F;data&#x2F;db156.err&#39;.</span><br><span class="line">Jun 10 04:57:13 db156 mysqld_safe[14232]: 2021-06-10T08:57:13.689214Z mysqld_safe Starting mysqld daemon with databases from &#x2F;data&#x2F;mysql&#x2F;data</span><br></pre></td></tr></table></figure>

<p>在执行<code>systemctl start mysqld </code>如果报错<code>Failed to start mysqld.service: Unit not found.</code>,可以执行<code>systemctl daemon-reload</code>解决。</p>
<h3 id="修改本地账号密码并设置不过期"><a href="#修改本地账号密码并设置不过期" class="headerlink" title="修改本地账号密码并设置不过期"></a>修改本地账号密码并设置不过期</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -e &quot;SET SQL_LOG_BIN&#x3D;0;SET global super_read_only&#x3D;OFF; SET global read_only&#x3D;OFF; alter user &#39;root&#39;@&#39;localhost&#39; password expire never; set password for &#39;root&#39;@&#39;localhost&#39;&#x3D;&#39;123456&#39;;flush privileges; SET SQL_LOG_BIN&#x3D;1;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="创建复制账号并授权"><a href="#创建复制账号并授权" class="headerlink" title="创建复制账号并授权"></a>创建复制账号并授权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 9</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; SET SQL_LOG_BIN&#x3D;0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.156&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;</span><br><span class="line">CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.157&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;</span><br><span class="line">CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.225&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.157&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE USER IF NOT EXISTS &#96;repl&#96;@&#96;192.168.165.225&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;</span><br><span class="line">GRANT REPLICATION SLAVE, REPLICATION CLIENT, BACKUP_ADMIN ON *.* TO &#96;repl&#96;@&#96;192.168.165.156&#96;; </span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT, BACKUP_ADMIN ON *.* TO &#96;repl&#96;@&#96;192.168.165.156&#96;; </span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT, BACKUP_ADMIN ON *.* TO &#96;repl&#96;@&#96;192.168.165.157&#96;; </span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT, BACKUP_ADMIN ON *.* TO &#96;repl&#96;@&#96;192.168.165.225&#96;; </span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SET SQL_LOG_BIN&#x3D;1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@db156 opt]# </span><br></pre></td></tr></table></figure>

<h3 id="创建管理账号并授权"><a href="#创建管理账号并授权" class="headerlink" title="创建管理账号并授权"></a>创建管理账号并授权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; SET SQL_LOG_BIN&#x3D;0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE USER IF NOT EXISTS &#96;icadmin&#96;@&#96;192.168.165.%&#96; IDENTIFIED BY &#39;123456&#39; PASSWORD EXPIRE NEVER;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT SELECT, RELOAD, SHUTDOWN, PROCESS, FILE, SUPER, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE USER ON *.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT BACKUP_ADMIN,CLONE_ADMIN,PERSIST_RO_VARIABLES_ADMIN,REPLICATION_APPLIER,SYSTEM_VARIABLES_ADMIN ON *.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;</span><br><span class="line">GRANT INSERT, UPDATE, DELETE ON &#96;mysql&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT INSERT, UPDATE, DELETE ON &#96;mysql&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT INSERT, UPDATE, DELETE, CREATE, DROP, REFERENCES, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, EVENT, TRIGGER ON &#96;mysql_innodb_cluster_metadata&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT INSERT, UPDATE, DELETE, CREATE, DROP, REFERENCES, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, EVENT, TRIGGER ON &#96;mysql_innodb_cluster_metadata_bkp&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT INSERT, UPDATE, DELETE, CREATE, DROP, REFERENCES, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, EVENT, TRIGGER ON &#96;mysql_innodb_cluster_metadata_previous&#96;.* TO &#96;icadmin&#96;@&#96;192.168.165.%&#96; WITH GRANT OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">SET SQL_LOG_BIN&#x3D;1;</span><br><span class="line">Query OK, 0 rows affected (0.32 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SET SQL_LOG_BIN&#x3D;1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@db156 opt]# </span><br></pre></td></tr></table></figure>



<h3 id="安装组复制插件"><a href="#安装组复制插件" class="headerlink" title="安装组复制插件"></a>安装组复制插件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 9</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;</span><br><span class="line">ERROR 1125 (HY000): Function &#39;group_replication&#39; already exists</span><br><span class="line">mysql&gt; SELECT PLUGIN_NAME, PLUGIN_STATUS FROM INFORMATION_SCHEMA.PLUGINS  WHERE PLUGIN_NAME LIKE &#39;%group_replication%&#39;;</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">| PLUGIN_NAME       | PLUGIN_STATUS |</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">| group_replication | ACTIVE        |</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@db156 opt]# </span><br></pre></td></tr></table></figure>



<h3 id="设置复制通道"><a href="#设置复制通道" class="headerlink" title="设置复制通道"></a>设置复制通道</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 10</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; CHANGE MASTER TO MASTER_USER&#x3D;&#39;repl&#39;, MASTER_PASSWORD&#x3D;&#39;123456&#39; FOR CHANNEL &#39;group_replication_recovery&#39;;</span><br><span class="line">Query OK, 0 rows affected, 5 warnings (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT User_name,Channel_name FROM mysql.slave_master_info WHERE user_name &#x3D; &#39;repl&#39;;</span><br><span class="line">+-----------+----------------------------+</span><br><span class="line">| User_name | Channel_name               |</span><br><span class="line">+-----------+----------------------------+</span><br><span class="line">| repl      | group_replication_recovery |</span><br><span class="line">+-----------+----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SET global group_replication_recovery_get_public_key&#x3D;ON;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@db156 opt]# </span><br></pre></td></tr></table></figure>



<h3 id="查看MySQL进程"><a href="#查看MySQL进程" class="headerlink" title="查看MySQL进程"></a>查看MySQL进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# ps -ef | grep mysql</span><br><span class="line">mysql    14232     1  0 04:57 ?        00:00:00 &#x2F;bin&#x2F;sh &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf</span><br><span class="line">mysql    14626 14232  0 04:57 ?        00:00:03 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql --datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;data --plugin-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin --log-error&#x3D;db156.err --pid-file&#x3D;db156.pid</span><br><span class="line">root     15500  9686  0 05:12 pts&#x2F;0    00:00:00 grep --color&#x3D;auto mysql</span><br><span class="line">[root@db156 opt]# </span><br></pre></td></tr></table></figure>



<blockquote>
<p>说明：其他两个节点也按照以上步骤部署</p>
</blockquote>
<h2 id="启用MGR组复制"><a href="#启用MGR组复制" class="headerlink" title="启用MGR组复制"></a>启用MGR组复制</h2><p>三个MySQL Server实例部署完成之后，就可以启用组复制了。</p>
<p>对于组复制，数据必须存储在InnoDB事务存储引擎中，使用其他存储引擎（包括临时 MEMORY存储引擎）可能会导致组复制中的错误。disabled_storage_engines 如下设置 系统变量以防止其使用：</p>
<p>disabled_storage_engines=”MyISAM,BLACKHOLE,FEDERATED,ARCHIVE,MEMORY”</p>
<p>修改配置文件，添加上面的配置并重启即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# vi &#x2F;etc&#x2F;my.cnf </span><br><span class="line">[root@db156 opt]# cat &#x2F;etc&#x2F;my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id&#x3D;13306</span><br><span class="line">gtid_mode&#x3D;on</span><br><span class="line">enforce_gtid_consistency&#x3D;1</span><br><span class="line">transaction_write_set_extraction&#x3D;XXHASH64</span><br><span class="line">loose-group_replication_group_name&#x3D;&#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&#39;</span><br><span class="line">loose-group_replication_start_on_boot&#x3D;off</span><br><span class="line">loose-group_replication_ip_whitelist&#x3D;&#39;192.168.165.0&#x2F;24&#39;</span><br><span class="line">loose-group_replication_local_address&#x3D;&#39;192.168.165.156:33061&#39;</span><br><span class="line">loose-group_replication_group_seeds&#x3D;&#39;192.168.165.156:33061,192.168.165.157:33061,192.168.165.225:33061&#39;</span><br><span class="line">loose-group_replication_bootstrap_group&#x3D;off</span><br><span class="line">loose-group_replication_single_primary_mode&#x3D;on</span><br><span class="line">loose-group_replication_enforce_update_everywhere_checks&#x3D;off</span><br><span class="line">loose-group_replication_recovery_get_public_key&#x3D;on</span><br><span class="line">loose-group_replication_recovery_use_ssl&#x3D;off</span><br><span class="line">loose-group_replication_ssl_mode&#x3D;&#39;DISABLED&#39;</span><br><span class="line">loose-group_replication_consistency&#x3D;&#39;EVENTUAL&#39;</span><br><span class="line">loose-group_replication_member_expel_timeout&#x3D;5</span><br><span class="line">report_host&#x3D;&#39;192.168.165.156&#39;</span><br><span class="line">report_port&#x3D;3306</span><br><span class="line">plugin_load_add &#x3D;&#39;group_replication.so&#39;</span><br><span class="line">auto_increment_increment&#x3D;1</span><br><span class="line">auto_increment_offset&#x3D;1</span><br><span class="line">mysqlx_port&#x3D;33060</span><br><span class="line">admin_port&#x3D;33062</span><br><span class="line">datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;data</span><br><span class="line">basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">user&#x3D;mysql</span><br><span class="line">bled_storage_engines&#x3D;&quot;MyISAM,BLACKHOLE,FEDERATED,ARCHIVE,MEMORY&quot;</span><br><span class="line">[root@db225 opt]# systemctl restart mysqld</span><br></pre></td></tr></table></figure>



<p>首次启动组复制的过程称为引导，，可以使用group_replication_bootstrap_group系统变量来引导组，且只能在一个实例上执行并只能执行一次。</p>
<p>我们选择节点一上执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; SET GLOBAL group_replication_bootstrap_group&#x3D;ON;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; START GROUP_REPLICATION USER&#x3D;&#39;repl&#39;, PASSWORD&#x3D;&#39;123456&#39;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (2.22 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SET GLOBAL group_replication_bootstrap_group&#x3D;OFF;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>

<p>节点二及节点三：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@db225 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uroot -S &#x2F;tmp&#x2F;mysql.sock -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; START GROUP_REPLICATION USER&#x3D;&#39;repl&#39;, PASSWORD&#x3D;&#39;123456&#39;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (2.64 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>

<p>在将其他节点添加至复制组时，如果报一下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START GROUP_REPLICATION USER&#x3D;&#39;repl&#39;, PASSWORD&#x3D;&#39;123456&#39;;</span><br><span class="line">ERROR 3092 (HY000): The server is not configured properly to be an active member of the group. Please see more details on error log.</span><br></pre></td></tr></table></figure>

<p>查看到日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2021-06-10T10:42:54.535154Z 10 [System] [MY-010597] [Repl] &#39;CHANGE MASTER TO FOR CHANNEL &#39;group_replication_applier&#39; executed&#39;. Previous state master_host&#x3D;&#39;&#39;, master_port&#x3D; 3306, master_log_file&#x3D;&#39;&#39;, master_log_pos&#x3D; 4, master_bind&#x3D;&#39;&#39;. New state master_host&#x3D;&#39;&lt;NULL&gt;&#39;, master_port&#x3D; 0, master_log_file&#x3D;&#39;&#39;, master_log_pos&#x3D; 4, master_bind&#x3D;&#39;&#39;.</span><br><span class="line">2021-06-10T10:42:57.045266Z 0 [ERROR] [MY-011526] [Repl] Plugin group_replication reported: &#39;This member has more executed transactions than those present in the group. Local transactions: 689d5d1d-c9cc-11eb-8243-005056a0d28b:1 &gt; Group transactions: aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&#39;</span><br><span class="line">2021-06-10T10:42:57.056782Z 0 [ERROR] [MY-011522] [Repl] Plugin group_replication reported: &#39;The member contains transactions not present in the group. The member will now exit the group.&#39;</span><br><span class="line">2021-06-10T10:42:57.056911Z 0 [System] [MY-011503] [Repl] Plugin group_replication reported: &#39;Group membership changed to 192.168.165.157:3306, 192.168.165.156:3306 on view 16233217077427225:2.&#39;</span><br><span class="line">2021-06-10T10:43:00.730039Z 0 [System] [MY-011504] [Repl] Plugin group_replication reported: &#39;Group membership changed: This member has left the group.&#39;</span><br><span class="line">2021-06-10T10:43:00.758719Z 9 [System] [MY-011566] [Repl] Plugin group_replication reported: &#39;Setting super_read_only&#x3D;OFF.&#39;</span><br></pre></td></tr></table></figure>

<p>则在该节点上执行<code>reset master</code>可以解决。</p>
<p>查看组复制状态(任何一个实例均可查询)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+-----------------+-------------+--------------+-------------+----------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST     | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION |</span><br><span class="line">+---------------------------+--------------------------------------+-----------------+-------------+--------------+-------------+----------------+</span><br><span class="line">| group_replication_applier | 689d5d1d-c9cc-11eb-8243-005056a0d28b | 192.168.165.157 |        3306 | ONLINE       | SECONDARY   | 8.0.25         |</span><br><span class="line">| group_replication_applier | 71d57215-c9cc-11eb-a5ac-005056a098ec | 192.168.165.225 |        3306 | ONLINE       | SECONDARY   | 8.0.25         |</span><br><span class="line">| group_replication_applier | 8b5f525d-c9c3-11eb-bf4e-005056a0bb1a | 192.168.165.156 |        3306 | ONLINE       | PRIMARY     | 8.0.25         |</span><br><span class="line">+---------------------------+--------------------------------------+-----------------+-------------+--------------+-------------+----------------+</span><br><span class="line">3 rows in set (1.54 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>

<p>至此，MGR三节点的组复制搭建完成。</p>
<h2 id="安装MySQL-Shell"><a href="#安装MySQL-Shell" class="headerlink" title="安装MySQL Shell"></a>安装MySQL Shell</h2><p>安装过程如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# tar -xf mysql-shell-8.0.25-linux-glibc2.12-x86-64bit.tar.gz </span><br><span class="line">[root@db156 opt]# mv mysql-shell-8.0.25-linux-glibc2.12-x86-64bit &#x2F;usr&#x2F;local&#x2F;mysqlshell</span><br><span class="line">[root@db156 opt]# chown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysqlshell&#x2F;</span><br><span class="line">[root@db156 opt]# chmod -R 755 &#x2F;usr&#x2F;local&#x2F;mysqlshell&#x2F;</span><br><span class="line">[root@db156 opt]# echo &quot;export PATH&#x3D;\$PATH:&#x2F;usr&#x2F;local&#x2F;mysqlshell&#x2F;bin&quot; &gt;&gt; &#x2F;etc&#x2F;profile</span><br><span class="line">[root@db156 opt]# source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>三个节点均执行以上步骤安装。</p>
<h2 id="创建InnoDB-Cluster集群"><a href="#创建InnoDB-Cluster集群" class="headerlink" title="创建InnoDB Cluster集群"></a>创建InnoDB Cluster集群</h2><p>通过mysqlsh命令使用安装MySQL Server时创建的管理账号连接到MySQL 实例，执行<code>dba.createCluster()</code>创建集群，并过过<code>dba.getCluster(&quot;testCluster&quot;).status()</code>查看集群状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[root@db225 opt]# mysqlsh icadmin@192.168.165.156:3306</span><br><span class="line">Please provide the password for &#39;icadmin@192.168.165.156:3306&#39;: ******</span><br><span class="line">Save password for &#39;icadmin@192.168.165.156:3306&#39;? [Y]es&#x2F;[N]o&#x2F;Ne[v]er (default No): </span><br><span class="line">MySQL Shell 8.0.25</span><br><span class="line"></span><br><span class="line">Copyright (c) 2016, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its affiliates.</span><br><span class="line">Other names may be trademarks of their respective owners.</span><br><span class="line"></span><br><span class="line">Type &#39;\help&#39; or &#39;\?&#39; for help; &#39;\quit&#39; to exit.</span><br><span class="line">Creating a session to &#39;icadmin@192.168.165.156:3306&#39;</span><br><span class="line">Fetching schema names for autocompletion... Press ^C to stop.</span><br><span class="line">Your MySQL connection id is 28</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line">No default schema selected; type \use &lt;schema&gt; to set one.</span><br><span class="line"> MySQL  192.168.165.156:3306 ssl  JS &gt; var cluster &#x3D; dba.createCluster(&#39;testCluster&#39;, &#123;adoptFromGR: true&#125;);</span><br><span class="line">A new InnoDB cluster will be created based on the existing replication group on instance &#39;192.168.165.156:3306&#39;.</span><br><span class="line"></span><br><span class="line">Creating InnoDB cluster &#39;testCluster&#39; on &#39;192.168.165.156:3306&#39;...</span><br><span class="line"></span><br><span class="line">Adding Seed Instance...</span><br><span class="line">Adding Instance &#39;192.168.165.157:3306&#39;...</span><br><span class="line">Adding Instance &#39;192.168.165.225:3306&#39;...</span><br><span class="line">Adding Instance &#39;192.168.165.156:3306&#39;...</span><br><span class="line">Resetting distributed recovery credentials across the cluster...</span><br><span class="line">NOTE: User &#39;mysql_innodb_cluster_13306&#39;@&#39;%&#39; already existed at instance &#39;192.168.165.156:3306&#39;. It will be deleted and created again with a new password.</span><br><span class="line">NOTE: User &#39;mysql_innodb_cluster_13306&#39;@&#39;%&#39; already existed at instance &#39;192.168.165.156:3306&#39;. It will be deleted and created again with a new password.</span><br><span class="line">Cluster successfully created based on existing replication group.</span><br><span class="line"></span><br><span class="line"> MySQL  192.168.165.156:3306 ssl  JS &gt; dba.getCluster(&quot;testCluster&quot;).status();</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;testCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;192.168.165.156:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is ONLINE and can tolerate up to ONE failure.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;192.168.165.156:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;192.168.165.156:3306&quot;, </span><br><span class="line">                &quot;instanceErrors&quot;: [</span><br><span class="line">                    &quot;NOTE: The required parallel-appliers settings are not enabled on the instance. Use dba.configureInstance() to fix it.&quot;</span><br><span class="line">                ], </span><br><span class="line">                &quot;memberRole&quot;: &quot;PRIMARY&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;replicationLag&quot;: null, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;, </span><br><span class="line">                &quot;version&quot;: &quot;8.0.25&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;192.168.165.157:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;192.168.165.157:3306&quot;, </span><br><span class="line">                &quot;instanceErrors&quot;: [</span><br><span class="line">                    &quot;NOTE: The required parallel-appliers settings are not enabled on the instance. Use dba.configureInstance() to fix it.&quot;</span><br><span class="line">                ], </span><br><span class="line">                &quot;memberRole&quot;: &quot;SECONDARY&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;O&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;replicationLag&quot;: null, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;, </span><br><span class="line">                &quot;version&quot;: &quot;8.0.25&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;192.168.165.225:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;192.168.165.225:3306&quot;, </span><br><span class="line">                &quot;instanceErrors&quot;: [</span><br><span class="line">                    &quot;NOTE: The required parallel-appliers settings are not enabled on the instance. Use dba.configureInstance() to fix it.&quot;</span><br><span class="line">                ], </span><br><span class="line">                &quot;memberRole&quot;: &quot;SECONDARY&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;O&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;replicationLag&quot;: null, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;, </span><br><span class="line">                &quot;version&quot;: &quot;8.0.25&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;topologyMode&quot;: &quot;Single-Primary&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;192.168.165.156:3306&quot;</span><br><span class="line">&#125;</span><br><span class="line"> MySQL  192.168.165.156:3306 ssl  JS &gt; </span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>“status”: “OK” 表示集群状态是正常的</li>
<li>“topologyMode”: “Single-Primary” 表示是单主模式</li>
<li>“mode”: “R/W” 表示可读可写</li>
<li>“mode”: “R/O” 表示只读</li>
</ul>
<h2 id="安装MySQL-Router"><a href="#安装MySQL-Router" class="headerlink" title="安装MySQL Router"></a>安装MySQL Router</h2><p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# tar -xf mysql-router-8.0.25-linux-glibc2.12-x86_64.tar.xz </span><br><span class="line">[root@db156 opt]# mv mysql-router-8.0.25-linux-glibc2.12-x86_64 &#x2F;usr&#x2F;local&#x2F;mysqlrouter</span><br><span class="line">[root@db156 opt]# chown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;</span><br><span class="line">[root@db156 opt]# chmod -R 755 &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;</span><br><span class="line">[root@db156 opt]# mkdir -p &#x2F;data&#x2F;mysqlrouter</span><br><span class="line">[root@db156 opt]# chown -R mysql:mysql &#x2F;data&#x2F;mysqlrouter&#x2F;</span><br><span class="line">[root@db156 opt]# echo &quot;export PATH&#x3D;\$PATH:&#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&quot; &gt;&gt; &#x2F;etc&#x2F;profile</span><br><span class="line">[root@db156 opt]# source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>bootstrap引导:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&#x2F;mysqlrouter --bootstrap icadmin@192.168.165.156:3306 --directory &#x2F;data&#x2F;mysqlrouter --conf-use-sockets --user&#x3D;mysql --name&#x3D;mysql_router_13306 --conf-bind-address&#x3D;192.168.165.156 --account-host&#x3D;&quot;192.168.165.%&quot;</span><br><span class="line">Please enter MySQL password for icadmin: </span><br><span class="line"># Bootstrapping MySQL Router instance at &#39;&#x2F;data&#x2F;mysqlrouter&#39;...</span><br><span class="line"></span><br><span class="line">- Creating account(s) (only those that are needed, if any)</span><br><span class="line">- Verifying account (using it to run SQL queries that would be run by Router)</span><br><span class="line">- Storing account in keyring</span><br><span class="line">- Adjusting permissions of generated files</span><br><span class="line">- Creating configuration &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf</span><br><span class="line"></span><br><span class="line"># MySQL Router &#39;mysql_router_13306&#39; configured for the InnoDB Cluster &#39;testCluster&#39;</span><br><span class="line"></span><br><span class="line">After this MySQL Router has been started with the generated configuration</span><br><span class="line"></span><br><span class="line">    $ &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&#x2F;mysqlrouter -c &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf</span><br><span class="line"></span><br><span class="line">the cluster &#39;testCluster&#39; can be reached by connecting to:</span><br><span class="line"></span><br><span class="line">## MySQL Classic protocol</span><br><span class="line"></span><br><span class="line">- Read&#x2F;Write Connections: localhost:6446, &#x2F;data&#x2F;mysqlrouter&#x2F;mysql.sock</span><br><span class="line">- Read&#x2F;Only Connections:  localhost:6447, &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlro.sock</span><br><span class="line"></span><br><span class="line">## MySQL X protocol</span><br><span class="line"></span><br><span class="line">- Read&#x2F;Write Connections: localhost:6448, &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlx.sock</span><br><span class="line">- Read&#x2F;Only Connections:  localhost:6449, &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlxro.sock</span><br><span class="line"></span><br><span class="line">[root@db156 opt]# </span><br></pre></td></tr></table></figure>

<p>引导成功后会在/data/mysqlrouter目录下生成所需的数据文件，目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# tree &#x2F;data&#x2F;mysqlrouter&#x2F;</span><br><span class="line">&#x2F;data&#x2F;mysqlrouter&#x2F;</span><br><span class="line">├── data</span><br><span class="line">│   ├── ca-key.pem</span><br><span class="line">│   ├── ca.pem</span><br><span class="line">│   ├── keyring</span><br><span class="line">│   ├── router-cert.pem</span><br><span class="line">│   ├── router-key.pem</span><br><span class="line">│   └── state.json</span><br><span class="line">├── log</span><br><span class="line">│   └── mysqlrouter.log</span><br><span class="line">├── mysqlrouter.conf</span><br><span class="line">├── mysqlrouter.key</span><br><span class="line">├── run</span><br><span class="line">├── start.sh</span><br><span class="line">└── stop.sh</span><br><span class="line"></span><br><span class="line">3 directories, 11 files</span><br></pre></td></tr></table></figure>

<p>生成的MySQL Router配置文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# cat &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf </span><br><span class="line"># File automatically generated during MySQL Router bootstrap</span><br><span class="line">[DEFAULT]</span><br><span class="line">name&#x3D;mysql_router_13306</span><br><span class="line">user&#x3D;mysql</span><br><span class="line">logging_folder&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;log</span><br><span class="line">runtime_folder&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;run</span><br><span class="line">data_folder&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data</span><br><span class="line">keyring_path&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;keyring</span><br><span class="line">master_key_path&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.key</span><br><span class="line">connect_timeout&#x3D;15</span><br><span class="line">read_timeout&#x3D;30</span><br><span class="line">dynamic_state&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;state.json</span><br><span class="line">client_ssl_cert&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;router-cert.pem</span><br><span class="line">client_ssl_key&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;router-key.pem</span><br><span class="line">client_ssl_mode&#x3D;PREFERRED</span><br><span class="line">server_ssl_mode&#x3D;AS_CLIENT</span><br><span class="line">server_ssl_verify&#x3D;DISABLED</span><br><span class="line"></span><br><span class="line">[logger]</span><br><span class="line">level &#x3D; INFO</span><br><span class="line"></span><br><span class="line">[metadata_cache:testCluster]</span><br><span class="line">cluster_type&#x3D;gr</span><br><span class="line">router_id&#x3D;1</span><br><span class="line">user&#x3D;mysql_router1_7d9sq1vuggg9</span><br><span class="line">metadata_cluster&#x3D;testCluster</span><br><span class="line">ttl&#x3D;0.5</span><br><span class="line">auth_cache_ttl&#x3D;-1</span><br><span class="line">auth_cache_refresh_interval&#x3D;2</span><br><span class="line">use_gr_notifications&#x3D;0</span><br><span class="line"></span><br><span class="line">[routing:testCluster_rw]</span><br><span class="line">bind_address&#x3D;192.168.165.156</span><br><span class="line">bind_port&#x3D;6446</span><br><span class="line">socket&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysql.sock</span><br><span class="line">destinations&#x3D;metadata-cache:&#x2F;&#x2F;testCluster&#x2F;?role&#x3D;PRIMARY</span><br><span class="line">routing_strategy&#x3D;first-available</span><br><span class="line">protocol&#x3D;classic</span><br><span class="line"></span><br><span class="line">[routing:testCluster_ro]</span><br><span class="line">bind_address&#x3D;192.168.165.156</span><br><span class="line">bind_port&#x3D;6447</span><br><span class="line">socket&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlro.sock</span><br><span class="line">destinations&#x3D;metadata-cache:&#x2F;&#x2F;testCluster&#x2F;?role&#x3D;SECONDARY</span><br><span class="line">routing_strategy&#x3D;round-robin-with-fallback</span><br><span class="line">protocol&#x3D;classic</span><br><span class="line"></span><br><span class="line">[routing:testCluster_x_rw]</span><br><span class="line">bind_address&#x3D;192.168.165.156</span><br><span class="line">bind_port&#x3D;6448</span><br><span class="line">socket&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlx.sock</span><br><span class="line">destinations&#x3D;metadata-cache:&#x2F;&#x2F;testCluster&#x2F;?role&#x3D;PRIMARY</span><br><span class="line">routing_strategy&#x3D;first-available</span><br><span class="line">protocol&#x3D;x</span><br><span class="line"></span><br><span class="line">[routing:testCluster_x_ro]</span><br><span class="line">bind_address&#x3D;192.168.165.156</span><br><span class="line">bind_port&#x3D;6449</span><br><span class="line">socket&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlxro.sock</span><br><span class="line">destinations&#x3D;metadata-cache:&#x2F;&#x2F;testCluster&#x2F;?role&#x3D;SECONDARY</span><br><span class="line">routing_strategy&#x3D;round-robin-with-fallback</span><br><span class="line">protocol&#x3D;x</span><br><span class="line"></span><br><span class="line">[http_server]</span><br><span class="line">port&#x3D;8443</span><br><span class="line">ssl&#x3D;1</span><br><span class="line">ssl_cert&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;router-cert.pem</span><br><span class="line">ssl_key&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;data&#x2F;router-key.pem</span><br><span class="line"></span><br><span class="line">[http_auth_realm:default_auth_realm]</span><br><span class="line">backend&#x3D;default_auth_backend</span><br><span class="line">method&#x3D;basic</span><br><span class="line">name&#x3D;default_realm</span><br><span class="line"></span><br><span class="line">[rest_router]</span><br><span class="line">require_realm&#x3D;default_auth_realm</span><br><span class="line"></span><br><span class="line">[rest_api]</span><br><span class="line"></span><br><span class="line">[http_auth_backend:default_auth_backend]</span><br><span class="line">backend&#x3D;metadata_cache</span><br><span class="line"></span><br><span class="line">[rest_routing]</span><br><span class="line">require_realm&#x3D;default_auth_realm</span><br><span class="line"></span><br><span class="line">[rest_metadata_cache]</span><br><span class="line">require_realm&#x3D;default_auth_realm</span><br><span class="line"></span><br><span class="line">[root@db156 opt]# </span><br></pre></td></tr></table></figure>

<p>启动MySQL路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# bash &#x2F;data&#x2F;mysqlrouter&#x2F;start.sh 2&gt;&amp;1 &gt; &#x2F;dev&#x2F;null &amp;</span><br><span class="line">[root@db156 opt]# ps -ef | grep mysqlrouter</span><br><span class="line">root     24911     1  0 08:00 pts&#x2F;0    00:00:00 sudo ROUTER_PID&#x3D;&#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.pid &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&#x2F;mysqlrouter -c &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf --user&#x3D;mysql</span><br><span class="line">mysql    24913 24911  2 08:00 pts&#x2F;0    00:00:01 &#x2F;usr&#x2F;local&#x2F;mysqlrouter&#x2F;bin&#x2F;mysqlrouter -c &#x2F;data&#x2F;mysqlrouter&#x2F;mysqlrouter.conf --user&#x3D;mysql</span><br><span class="line">root     24998  9686  0 08:01 pts&#x2F;0    00:00:00 grep --color&#x3D;auto mysqlrouter</span><br></pre></td></tr></table></figure>

<p>读写分离测试：使用不同的端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uicadmin -p -h 192.168.165.156 -P 6446    </span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 196</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; select @@hostname as hostname, @@port as port;</span><br><span class="line">+----------+------+</span><br><span class="line">| hostname | port |</span><br><span class="line">+----------+------+</span><br><span class="line">| db156    | 3306 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uicadmin -p -h 192.168.165.156 -P 6447</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 30</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; select @@hostname as hostname, @@port as port;</span><br><span class="line">+----------+------+</span><br><span class="line">| hostname | port |</span><br><span class="line">+----------+------+</span><br><span class="line">| db225    | 3306 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@db156 opt]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -uicadmin -p -h 192.168.165.156 -P 6447</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 1517</span><br><span class="line">Server version: 8.0.25 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; select @@hostname as hostname, @@port as port;</span><br><span class="line">+----------+------+</span><br><span class="line">| hostname | port |</span><br><span class="line">+----------+------+</span><br><span class="line">| db157    | 3306 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>

<p>可以看到使用读写端口6446时连接的是主节点，而使用只读端口6447连接时是在两个从节点之间切换操作。</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/InnoDB-Cluster/" rel="tag">InnoDB Cluster</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/MySQL/" rel="tag">MySQL</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/07/01/Python%E7%AE%97%E6%B3%95%E4%B9%8B%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/"
                    data-tooltip="冒泡算法的Python实现"
                    aria-label="上一篇: 冒泡算法的Python实现"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/06/08/Django%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"
                    data-tooltip="Django常见问题"
                    aria-label="下一篇: Django常见问题"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                    title="分享到 Weibo"
                    aria-label="分享到 Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/&amp;title=InnoDB Cluster部署"
                    title="分享到 QQ"
                    aria-label="分享到 QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                    title="分享到 Qzone"
                    aria-label="分享到 Qzone"
                >
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                    title="分享到 Renren"
                    aria-label="分享到 Renren"
                >
                    <i class="fab fa-renren" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 CodingCat. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/07/01/Python%E7%AE%97%E6%B3%95%E4%B9%8B%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/"
                    data-tooltip="冒泡算法的Python实现"
                    aria-label="上一篇: 冒泡算法的Python实现"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/06/08/Django%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"
                    data-tooltip="Django常见问题"
                    aria-label="下一篇: Django常见问题"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                    title="分享到 Weibo"
                    aria-label="分享到 Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/&amp;title=InnoDB Cluster部署"
                    title="分享到 QQ"
                    aria-label="分享到 QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                    title="分享到 Qzone"
                    aria-label="分享到 Qzone"
                >
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                    title="分享到 Renren"
                    aria-label="分享到 Renren"
                >
                    <i class="fab fa-renren" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                        aria-label="分享到 Weibo"
                    >
                        <i class="fab fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/&amp;title=InnoDB Cluster部署"
                        aria-label="分享到 QQ"
                    >
                        <i class="fab fa-qq" aria-hidden="true"></i><span>分享到 QQ</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                        aria-label="分享到 Qzone"
                    >
                        <i class="fa fa-star" aria-hidden="true"></i><span>分享到 Qzone</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://widget.renren.com/dialog/share?resourceUrl=http://blog.codingcat.net/2021/06/10/InnoDB-Cluster%E9%83%A8%E7%BD%B2/"
                        aria-label="分享到 Renren"
                    >
                        <i class="fab fa-renren" aria-hidden="true"></i><span>分享到 Renren</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/portrait.jpg" alt="作者的图片"/>
        
            <h4 id="about-card-name">CodingCat</h4>
        
            <div id="about-card-bio"><p>一个有诗意的程序员</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>运维开发工程师</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-qw5rhxhmpt1uwv7f09szl73tpjwdntnvosrl5jh6jtsqdqxvjfveyckvidtc.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
